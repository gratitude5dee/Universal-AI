import React, { ReactNode, useState, useEffect, useRef } from "react";
import Header from "../header";
import { motion, AnimatePresence } from "framer-motion";
import { useLocation } from "react-router-dom";
import { cn } from "../../../lib/utils";

interface MatrixDropProps {
  char: string;
  x: number;
  y: number;
  speed: number;
  opacity: number;
  delay: number;
}

const MatrixDrop: React.FC<MatrixDropProps> = ({ char, x, y, speed, opacity, delay }) => {
  return (
    <motion.div
      className="absolute text-green-500 font-mono text-lg"
      initial={{ y: -20, opacity: 0, x }}
      animate={{ 
        y: [y, y + 500], 
        opacity: [0, opacity, opacity, 0], 
      }}
      transition={{ 
        y: { duration: speed, ease: "linear", delay },
        opacity: { duration: speed, times: [0, 0.1, 0.9, 1], delay } 
      }}
      style={{ x }}
    >
      {char}
    </motion.div>
  );
};

const MatrixAnimation: React.FC<{onComplete: () => void}> = ({ onComplete }) => {
  const [drops, setDrops] = useState<React.ReactNode[]>([]);
  const [asciiArt, setAsciiArt] = useState<string[]>([]);
  const [showAscii, setShowAscii] = useState(false);
  const [isExiting, setIsExiting] = useState(false);
  const animationRef = useRef<number | null>(null);
  const completedRef = useRef(false);
  
  // Convert the ASCII art to an array of lines
  useEffect(() => {
    const art = `
                                           :..:                                                                                           
                                      .:.:..:.:.. :                                                                                       
                                        :.::.:.::..:.:.                                                                                   
                                     :.: :.:.::.::. :.:.                                                                                  
                                    ..:.:.:.:.:.:.:..::.                                                                                  
                    .+@@@*%@@@@@*-                  :.::.:.::.:.:.::.:.:.   :.                           .:..                                             
                   @%          #@@@@@+                .:.::.:.::.:.:.:.::.:.:.                        :.:.:::.:.:.. :                                     
                  @-             +@@@@@@-              :.:.:.:.:.::.:.:.:.:.::.:.                     .::.:.:.::.:                                        
                 @:                @@@@@@@=           :.:.:.::.::.:.::.:.::.:.:.:.:                .::.:.:.:.:.:.:                                        
                 @-                 @@@@@@@@-         .:.::.:.:.:.:.:.::.:.:.:.::.:.:.:.:.:.:.:.  :.::.:.:.::.:.:.:                                         
                 @.     @@-          @@@@@@@@@       :.::.:.:.:.:.:.::.:.:.::.:.:.::.::.::.:.:.:.:.:.:.:.::.:.::.:..                                        
                  @:   +@@@*         -@@@@@@@@@      .:.:.:.::.:.::...:.:.:.:.::.:.:.:.:.::.:.::.:.::.:.:.:.:.                                            
                   @@:   :@-          @@@@@@@@@@     .::.:.:.:.::.:         :.:.:.:.:.:.:.:.:.::.:.::.:.:.::                                              
                     -*#*-            %@@@@@@@@@%   :: .:.::.: .:.:         .:.::.::.::.::.:.:.:.::.:.:.::                                                
                                      :@@@@@@@@@@   .:.::.:.:.::.:             .:.:.:.:.:.::.::.:.:.:.::                                                  
                                       @@@@@@@@@@+  =@:.:.::.:.:.:..          .:  .:.:.:.:.:.:.:.:.::                                                     
                                       @@@@@@@@@@@.@@@@.:.:.:.:.:.::.        :.:.::.::.::.:.:.                                                            
                                       @@@@@@@@@@@@@--.:.:.::.::.:.:         .:.:.:.:.:.:.:.:                                                             
                                       @@@@@@@@@@@#:.:.::.:.:.:.::..       : :.::.:.::.:.:.:.:.                                                          
                                       @@@@@@@@@@@@+.::.:.::.:.:.::.    .:.:.::.:.::.:.::.::.::.:.                                                        
                                       @@@@@@@@@@@%@::.:.:.:.::.:.:    .:.:.:. .:.:.:.:.:.:.:.:.::.:                                 #                    
                                -      @@@@@@@@@@@@@+:.:.::.:.:.:.   .:.::.:.::.::.:.  .::.:.:.:.::.:                               @@                    
                               :@@     @@@@@@@@@@@@@.:.::.:.:.::.::   :.:.::.:.:.:.: :#-==.::.::.:.:.::.                          @@@@@                   
                              -@@@@+   @@@@@@@@@@@@@-:.:.:.:.:.:.:.:.:.:.:.:.:.:.:::@@%@@@@.::.:.:.:.:.                         @@@@@@@@-                 
                            .@@@@@@@@@@@@@@@@@@@@@@@@@:.:.::.::.:.:.::.:.::.:  :@@@@@@@@@@%+.:.:.:.:.:.                     #@@@@@@@@@@@=               
                          .@@@@@@@@@@@@@@@@@@@@@@@@@=:.:.:.:.:.:.:.::.:.::.:.:: @@@@@@@@@@@@@@@#::.::.:.::.                 #@@@@@@@@@@@@@@@#             
                        @@@@@@@@@@@@@@@@@@@@@@@@@%@@@@.::.:.:.:.::.:.:.:.:.. .@@@@@@@@@@@@@@@@+=@::.:.::.:.:.             *@@@@@@@@@@@@@@@@@@@@+   @.     
                    :@@@@@@-@@@@@@@@@@@@@@@@@@@@@@@.:.:.:.::.::.:.:.:.::.:::@@@. @@@@@@@@@@@@@@@#@#:.:.:.:.::           @@@@ =@@@@@@@@@@@@@@@@@@@@+       
               =*@@@@@@@@@@= -@@@@@@@@@@@@@@@@@@@@@+::.:.:.::.:.:.::.:.:.:%@@@@:  :@@@@@@@@@@@@@@@::.:.:.::.:.:.:    +@@@@@@   @@@@@@@@@@@@@@@@@@         
       :%@@@@@@@@@@@@@@@@@@=    %@@@@@@@@@@@@@@@@@@@=.::.::.:.:.::.:.::.:@@@@@@.    #@@@@@@@@@@@+-.::.::.:.:.::   -@@@@@@@@@    :@@@@@@@@@@@@@@           
          -%@@@@@@@@@@@@@@@=       +%@@@@@@@@@@@@@@@@@ :.:.:.:.:.:.::.:.@@@@@@@:      #@@@@@@@@@@:   ..:.:.:.:.=@@@@@@@@@@@@      -@@@@@@@@@@*            
            *@@@@@@@@@@@@@@+           @@@@@@@@@@@@@@@.:.:.:.::.:.:.:.@@@@@@@@@.        -@@@@@@:. :.:::.::.::.-@@@@@@@@@@@@@         *@@@@@@              
            *@@@@@@@@@@@@@@=           @@@@@@@@@@@:@@-:.::.::.:.::-:-@@@@@@@@@@:           -@@ :.:.:..      .:::@@@@@@@@@@@@            @@                
            *@@@@@@@@@@@@@@=           @@@@@@@@@@@@@@@:.:.:.:.:.:@@:@@@@@@@@@@.         :@@. .:.:  ::.:.:.:.:..+@@@@@@@@@@@          *@+                 
            *@@@@@@@@@@@@@@=           @@@@@@@@@@@@@@@.:.:.:.:.:.::@@@@@@@@@@@@:        %@-      .:..:.::.:.:.:=@@@@@@@@@@@@        -@@                   
            *@@@@@@@@@@@@@@=           @@@@@@@@@@@@@@@ :.::.:.:.:.@@@@@@@@@@@@@. #@@- *@*         .::.:.:.::.::@@@@@@@@@@@@@ :@@# :@@.                    
            *@@@@@@@@@@@@@@+           @@@@@@@@@@@@@@@ :.:.::.::.=@@@@@@@@@@@@@:=@@@@@=         .:.:.::.::.:.:@@@@@@@@@@@@@@ @@@@@#                       
            *@@@@@@@@@@@@@@=           @@@@@@@@@@@@*@@ .:.:.:.:.:=@@@@@@@@@@@@@.  ::             .:    :..:.:.%@@@@@@@@@@@@@   :.                         
            *@@@@@@@@@@@@@@=           @@@@@@@@@@@@@@@ :.::.::.:.+@@@@@@@@@@@@@:                 :.:.:  ..::.::@@@@@@@@@@@@@                              
            *@@@@@@@@@@@@@@=           @@@@@@@@@@@@@@@  :.:.:.:. +@@@@@@@@@@@@@@@%#+=              :.:..:.:.:.*@@@@@@@@@@@@@@#*+:                        
            *@@@@@@@@@@@@@@@@.         @@@@@@@@@@@@@@@@@=:.::.:. .-@@@=.-+%@@@@@@@@@@@@@@@@@%+     .:::.::.::.:@@@@@@@@@@@@@@@@@@@@@@@@@#:       -@@=    
            +@@@@@@@@@@@@@@@@@@@+      @@@@@@@@@@@@@*== .:.:.: :.+@@@%@*@@@@@@@@@@@@@@@@@@#@@@@@#::.:.:.:.:.:.:@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@+@@=       
            @@@@@@@@@@@@@@@@@@@@@@@*   @@@@@@@@=        .::.:.    @@-#@@@@@@@@@@@@@@@@@@@@@@=@+:..:.:.:.:.:.::@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@          
          %@@@@@@@@@@@@@@@@@@@@@@@@@@@+@@@@@.           .:.:.    %@@@@@@@-@==@@%@@.:=@@@@@@@@@@::.::.:.::.:: +@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@            
        %@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*               :.:   @@@@@@@@%@%=:@@@@=::.:%@@@@@@@@%.:.:.:.:.:. =@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@              
       +.     =#@@@@@@@@@@@@@@@@@@@@@@@=                 .:.-@@@@@@@@@%@+ :.:.:.:.:.-@@@@@+#@@.:.:.::.   #@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@+               
                     +@@@@@@@@@@@@@@@+                   :.@@@*.        . .:.   .:.:=@@@+:.:.:.::.: .: #@@#=                   =*@@@@@@@@:                
                         -#@@@@@@@@@                     *#.                 . :. :.:..:.:.:.::. :.  -@-                            +@@@                  
                             -@@@@+                                                :.::.:.                                                                
                                @@   :.:..                                                           .:.:.:           ..:..                               
                                -  :.:.:::.::  :.::.::.::.::.:::         :.:.::.::.::.::.:  .::   :.::.::.::.:.    :.:::.:::.:                            
                                  :.        :.       ::      :.:         ::.:.          :.: :.: .:.          :::  .:.       :..                           
                                  .::.:              .:      :.:         .:.::           :..:.: ::            .:. .::.:                                   
                                     :.::.::.:       :.      .::         :.:.:           ::.::. .:             ::    :.:.::.::                            
                                 .:          ::      ::      ::.         :. :.           .::.:. :.            .:. .:         .:.                          
                                 :.::       .:.      :.       .::       :.. ::         :::. .::  ::.        .::.  :.:.       ::.                          
                                    :.::.:::.:       ::         .::.:::.:   .:.::.:.::.:    :.:   :::.::.:::.:      .::.::.::.
